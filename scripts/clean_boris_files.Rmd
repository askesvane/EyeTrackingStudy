---
title: "clean_boris_files"
author: "Aske Svane Qvist"
date: "15 April 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

# Gather all the data from boris.

In this script, all boris output files will be cleaned up and gathered in a single csv-file. Redundant columns will be dropped and participantID and block number from the filename will be added to columns in the dataframe. The final dataframe will be saved as 'boris_cleaned' in the folder 'gathered_files'.

## Packages
```{r}
library(pacman)
p_load(janitor, tidyverse, stringi)

```


## Loop over all raw boris files
```{r}

# Loop over each filename in a given folder and import the data.
path <- "../data/Boris_raw_data/"
filenames_boris <- list.files(path = path, pattern = ".csv")

# Create empty container to which data from each csv will be attached
data_clean <- tibble(
  time = numeric(),
  total_length = numeric(),
  FPS = numeric(),
  behvaior = factor(),
  behavioral_category = factor(),
  status = factor(),
  participantID = factor(), 
  block = factor()
)

# Loop over all files in the folder and combine into one great dataframe.
for (i in 1:length(filenames_boris)){
  
  filename <- filenames_boris[i]
  
  # Get ID and block from filename
  participantID <- as.numeric(regmatches(filename, regexpr("[0-9]*[0-9]", filename)))
  block <- as.numeric(stri_extract_last_regex(filename, "\\d{1}"))
  
  # Import data from filename
  filepath = paste(path,filename, sep = "")
  boris <- read_csv(filepath)
  
  # Remove the empty spaces in the first 14 rows
  boris <- boris[-c(1:14), ] 
  
  boris <- boris %>% 
    row_to_names(row_number = 1) %>% 
    mutate(
      participantID = participantID,
      block = block) %>% 
    select(1,3,4,6,7,9:11) %>% 
    rename(
      time = Time,
      behavior = Behavior,
      status = Status
    )

  names(boris)[names(boris) == "Total length"] <- "total_length"
  names(boris)[names(boris) == "Behavioral category"] <- "behavioral_category"
  
  #Combine with premade empty dataframe
  if (nrow(data_clean) == 0) {
    data_clean <- boris}
  else {
    data_clean <- rbind(data_clean, boris)}
  
}


# save as csv file
write_csv(data_clean,"../data/gathered_files/boris_cleaned.csv")


```

